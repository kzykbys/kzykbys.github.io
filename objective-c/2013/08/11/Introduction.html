	<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Introction to DropBox SDK</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
		<link rel="stylesheet" href="/css/main.css">
        <link rel="stylesheet" href="/css/jquery.sidr.dark.css">
		<link href='http://fonts.googleapis.com/css?family=Gruppo' rel='stylesheet' type='text/css'>
		<link href='http://fonts.googleapis.com/css?family=Josefin+Sans' rel='stylesheet' type='text/css'>

	</head>
	
	<body>
    
        <div id="mobile-sticky-menu">
	<a   class="slide-menu" id="mobile-menu-button" href="#sidr">Menu</a>
	<img class="slide-menu" id="mobile-logo" src="/images/a.png" width="24" height="24" alt="" />
</div>

<div id="sidr">
	<!-- Your content -->
	<!-- <h4>Share</h4> -->

	<h4>Category</h4>
	<ul>
	   
		   <li>
		   		<a href="/categories/objective-c">objective-c</a>
		   </li>
	   
		   <li>
		   		<a href="/categories/other">other</a>
		   </li>
	   
		   <li>
		   		<a href="/categories/node-js">node.js</a>
		   </li>
	   
		   <li>
		   		<a href="/categories/ruby-on-rails">ruby on rails</a>
		   </li>
	   
		   <li>
		   		<a href="/categories/tips">tips</a>
		   </li>
	   
		   <li>
		   		<a href="/categories/html5">html5</a>
		   </li>
	   
		   <li>
		   		<a href="/categories/algorithms">algorithms</a>
		   </li>
	   
		   <li>
		   		<a href="/categories/machine-learning">machine learning</a>
		   </li>
	   
		   <li>
		   		<a href="/categories/c">c</a>
		   </li>
	   
		   <li>
		   		<a href="/categories/ruby">ruby</a>
		   </li>
	   
    </ul>
	<h4>Archive</h4>
	<ul>
		
			<li>
				<a href="/2013/08/">2013/08</a>
			</li>
		
			<li>
				<a href="/2013/09/">2013/09</a>
			</li>
		
			<li>
				<a href="/2013/11/">2013/11</a>
			</li>
		
			<li>
				<a href="/2013/12/">2013/12</a>
			</li>
		
			<li>
				<a href="/2014/01/">2014/01</a>
			</li>
		
			<li>
				<a href="/2014/03/">2014/03</a>
			</li>
		
			<li>
				<a href="/2014/04/">2014/04</a>
			</li>
		
			<li>
				<a href="/2014/05/">2014/05</a>
			</li>
		
	</ul>

	<img src="/images/me.png" alt="me" />

</div>


        <div class="site">

			<!-- title -->
			<!-- Header -->
<header>
<h1><a href="http://blog.kazuya.co/"><img src="/images/title.png" alt="logo" /></a></h1>
	<hr />
</header>

			<div id="contents">
				
				<div id="main">
					<h3><a href="">Introction to DropBox SDK</a></h3>
					<p class="author">
						<span class="date">2013-08-11 17:00:00 -0700</span>
					</p>
		      		
					<div class="post">
						<blockquote>
<blockquote>
<p><span class="deprecate">This article might be too old.</span>  </p>
</blockquote>
</blockquote>

<p>There are many applications that can communicate with DropBox. DropBox is the most famous storage service mainly because of how easy people can use it. I’m pretty sure that you’ve heard about it and that most of you are also using it. So, it is natural to think of making applications interact with it. I’d like to introduce how to implement DropBox service in your iOS application.</p>

<h3 id="toc_0">1. Introduction</h3>

<p>Let’s get started. First of all, you should install the SDK from dropbox. ( The latest one is 1.3.5 ) <a href="https://www.dropbox.com/developers/core/sdks/ios">https://www.dropbox.com/developers/core/sdks/ios</a> After that, you should register your application at DropBox developer website. <a href="https://www.dropbox.com/developers/apps">https://www.dropbox.com/developers/apps</a> In my case, I want to make an app that makes csv files, gets them and display them. So, it goes like this :</p>

<p><img src="/images/2013/08/a.png" alt=""></p>

<p>You can get “App key” and “App secret”. We’ll use them when we write code. </p>

<h3 id="toc_1">2. Setting your app</h3>

<p>After you get DropBox SDK, you should integrate it into your app. In Xcode, you add “DropboxSDK.framework”. This can be accomplished by control-click on Project Navigator and “add files to blabla”. Also, DropBox uses “Security.framework” and “QuartzCore.framework” so please add the frameworks from project summary screen. After that, you can finally write your code. It’s fun!!</p>

<h3 id="toc_2">3. Implement DropBox SDK</h3>

<p>We add the code to make a session with dropbox:</p>

<div class="highlight"><pre><code class="objective-c"><span class="lineno">1</span> <span class="n">DBSession</span><span class="o">*</span> <span class="n">dbSession</span> <span class="o">=</span> <span class="p">[[</span><span class="n">DBSession</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">initWithAppKey</span><span class="o">:</span><span class="s">@&quot;blabla&quot;</span> <span class="c1">//Appkey</span>
<span class="lineno">2</span>                                                <span class="nl">appSecret:</span><span class="s">@&quot;blabla&quot;</span> <span class="c1">//secretkey</span>
<span class="lineno">3</span>                                                   <span class="nl">root:</span><span class="s">@&quot;sandbox&quot;</span><span class="p">];</span>
<span class="lineno">4</span> <span class="p">[</span><span class="n">DBSession</span> <span class="n">setSharedSession</span><span class="o">:</span><span class="n">dbSession</span><span class="p">];</span>
</code></pre></div>

<p>This code is “/* Creating and setting the shared DBSession should be done before any other Dropbox objects are used, perferrably in the UIApplication delegate. */ ”. </p>

<p>Also, you add this code in your view controller. </p>

<div class="highlight"><pre><code class="objective-c"><span class="lineno">1</span> <span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidAppear:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">animated</span>
<span class="lineno">2</span> <span class="p">{</span>
<span class="lineno">3</span>   <span class="p">[</span><span class="n">super</span> <span class="n">viewDidAppear</span><span class="o">:</span><span class="n">animated</span><span class="p">];</span>
<span class="lineno">4</span>   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">[[</span><span class="n">DBSession</span> <span class="n">sharedSession</span><span class="p">]</span> <span class="n">isLinked</span><span class="p">])</span>
<span class="lineno">5</span>   <span class="p">{</span>
<span class="lineno">6</span>       <span class="p">[[</span><span class="n">DBSession</span> <span class="n">sharedSession</span><span class="p">]</span> <span class="n">linkFromController</span><span class="o">:</span><span class="n">self</span><span class="p">];</span>
<span class="lineno">7</span>   <span class="p">}</span>
<span class="lineno">8</span> <span class="p">}</span>
</code></pre></div>

<p>There are many people who forget to edit Info.plist file ( I took some time to figure it out too ). In your Info.plist, please add this url scheme :CFBundleURLTypes CFBundleURLSchemes db-YourAPIKEY </p>

<p>One way of adding this code is to control-click the Info.plist file,“Open as...” and “Source Code”. If you forget this step, this kind of error message will appear:</p>

<blockquote>
<p>[ERROR] DropboxSDK: unable to link; app isn&#39;t registered for correct URL scheme</p>
</blockquote>

<p>At this time, you can see the login screen to dropbox when you launch your app. If you did it on viewDidLoad function, xcode will warn you about the window hierarchy and you’ll fail to show login screen.</p>

<p><img src="/images/2013/08/b.png" alt=""></p>

<h3 id="toc_3">4. How to use DropBox SDK</h3>

<p>So far we’ve only implemented DropBox SDK. I’d like to show some basic function to be able to use it. First, let’s add delegate and prepare for DBRestClient class. In your viewcontroller, add something like this : </p>

<div class="highlight"><pre><code class="objective-c"><span class="lineno">1</span> <span class="cp">#import &lt;UIKit/UIKit.h&gt;</span>
<span class="lineno">2</span> <span class="cp">#import &lt;DropboxSDK/DropboxSDK.h&gt;</span>
<span class="lineno">3</span> <span class="k">@interface</span> <span class="nc">KKViewController</span> : <span class="nc">UIViewController</span><span class="o">&lt;</span><span class="n">DBRestClientDelegate</span><span class="o">&gt;</span>
<span class="lineno">4</span> 
<span class="lineno">5</span> <span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">DBRestClient</span> <span class="o">*</span><span class="n">restClient</span><span class="p">;</span>
<span class="lineno">6</span> 
<span class="lineno">7</span> <span class="k">@end</span> 
</code></pre></div>

<p>We added “<DBRestClientDelegate>” and the property. 
After that, write getter to the restClient in your viewcontroller implement file like this : </p>

<div class="highlight"><pre><code class="objective-c"><span class="lineno"> 1</span> <span class="c1">// Getter</span>
<span class="lineno"> 2</span> <span class="k">-</span> <span class="p">(</span><span class="n">DBRestClient</span> <span class="o">*</span><span class="p">)</span><span class="nf">restClient</span>
<span class="lineno"> 3</span> <span class="p">{</span>
<span class="lineno"> 4</span>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_restClient</span><span class="p">)</span>
<span class="lineno"> 5</span>  <span class="p">{</span>
<span class="lineno"> 6</span>      <span class="n">restClient</span> <span class="o">=</span> <span class="p">[[</span><span class="n">DBRestClient</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">initWithSession</span><span class="o">:</span><span class="p">[</span><span class="n">DBSession</span> <span class="n">sharedSession</span><span class="p">]];</span>
<span class="lineno"> 7</span>      <span class="n">_restClient</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
<span class="lineno"> 8</span>  <span class="p">}</span>
<span class="lineno"> 9</span>  <span class="k">return</span> <span class="n">restClient</span><span class="p">;</span>
<span class="lineno">10</span> <span class="p">}</span>
</code></pre></div>

<h3 id="toc_4">5. Some Features</h3>

<p>Functions :</p>

<p>Loads metadata for the object at the given root/path and returns the result to the delegate as a dictionary</p>

<div class="highlight"><pre><code class="objective-c"><span class="lineno">1</span> <span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">loadMetadata:</span><span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="nv">path</span><span class="p">;</span>
</code></pre></div>

<p>Uploads a file that will be named filename to the given path on the server. sourcePath is the full path of the file you want to upload. If you are modifying a file, parentRev represents the rev of the file before you modified it as returned from the server. If you are uploading a new file set parentRev to nil.</p>

<div class="highlight"><pre><code class="objective-c"><span class="lineno">1</span> <span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">uploadFile:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">filename</span>
<span class="lineno">2</span>             <span class="nl">toPath:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">path</span>
<span class="lineno">3</span>    <span class="nl">withParentRev:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">parentRev</span>
<span class="lineno">4</span>         <span class="nl">fromPath:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">sourcePath</span><span class="p">;</span> 
</code></pre></div>

<p>Loads the file contents at the given root/path and stores the result into destinationPath</p>

<div class="highlight"><pre><code class="objective-c"><span class="lineno">1</span> <span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">loadFile:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">path</span> <span class="nf">intoPath:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">destinationPath</span><span class="p">;</span>
</code></pre></div>

<p>This function is for deleting your file.</p>

<div class="highlight"><pre><code class="objective-c"><span class="lineno">1</span>  <span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">deletePath</span><span class="o">:</span><span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="n">path</span><span class="p">;</span>
</code></pre></div>

<p>Delegate : </p>

<p>The delegate provides allows the user to get the result of the calls made on the DBRestClient. Right now, the error parameter of failed calls may be nil and [error localizedDescription] does not contain an error message appropriate to show to the user.</p>

<div class="highlight"><pre><code class="objective-c"><span class="lineno">1</span> <span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">restClient:</span><span class="p">(</span><span class="n">DBRestClient</span><span class="o">*</span><span class="p">)</span><span class="nv">client</span> <span class="nf">loadedMetadata:</span><span class="p">(</span><span class="n">DBMetadata</span><span class="o">*</span><span class="p">)</span><span class="nv">metadata</span><span class="p">;</span> 
</code></pre></div>

<h3 id="toc_5">6. End</h3>

<p>If you have any corrections or new ideas related to this post, please feel free to share your thoughts. Also, I made a simple application that can communicate with dropbox and show the csv file in collection view. If you’ll check this out, that would be great. <a href="https://github.com/kzykbys/DropBoxAPIwithCollectionView">https://github.com/kzykbys/DropBoxAPIwithCollectionView </a> Thank you.</p>

					</div>

				</div>

				<div id="sub">
				   <h4>About</h4>
<p><u>Kazuya Kobayshi</u><br />
- I'm a once law student trying to be computer geek.<br />
- ギークになりたい。<br />
<a href="mailto:kzy.kbys@gmail.com?subject=From Blog : &amp;body=Kazuya Kobayashi (小林和也)">kzy.kbys@gmail.com</a></p>
<h4>Elsewhere</h4>
<p>
   <a href="https://www.facebook.com/kbys.kzy">Facebook</a><br />
   <a href="https://twitter.com/kzy_kbys">Twitter</a><br />
   <a href="https://github.com/kzykbys">Github</a></p>
<h4>Category</h4>
<p>|
   
	   <a href="/categories/objective-c">objective-c</a> | 
   
	   <a href="/categories/other">other</a> | 
   
	   <a href="/categories/node-js">node.js</a> | 
   
	   <a href="/categories/ruby-on-rails">ruby on rails</a> | 
   
	   <a href="/categories/tips">tips</a> | 
   
	   <a href="/categories/html5">html5</a> | 
   
	   <a href="/categories/algorithms">algorithms</a> | 
   
	   <a href="/categories/machine-learning">machine learning</a> | 
   
	   <a href="/categories/c">c</a> | 
   
	   <a href="/categories/ruby">ruby</a> | 
   
</p>
<h4>Archive</h4>
   <p>|
   
		<a href="/2013/08/">2013/08</a> | 
   
		<a href="/2013/09/">2013/09</a> | 
   
		<a href="/2013/11/">2013/11</a> | 
   
		<a href="/2013/12/">2013/12</a> | 
   
		<a href="/2014/01/">2014/01</a> | 
   
		<a href="/2014/03/">2014/03</a> | 
   
		<a href="/2014/04/">2014/04</a> | 
   
		<a href="/2014/05/">2014/05</a> | 
   
</p>
<h4>Work</h4>			   
<p>Coming soon... maybe.</p>
				</div>

			</div>


		</div>

				<div class="footer">
		   <div class="footer_inner">
			   <div class="contact">
				   <h4>About</h4>
				   <p><u>Kazuya Kobayshi</u><br />
				   - I'm a once law student trying to be computer geek.<br />
				   - ギークになりたい。<br />
				   <a href="mailto:kzy.kbys@gmail.com?subject=From Blog : &amp;body=Kazuya Kobayashi (小林和也)">kzy.kbys@gmail.com</a></p>
				   <h4>Elsewhere</h4>
				   <p>
					   <a href="https://www.facebook.com/kbys.kzy">Facebook</a><br />
					   <a href="https://twitter.com/kzy_kbys">Twitter</a><br />
					   <a href="https://github.com/kzykbys">Github</a></p>
				   <h4>Category</h4>
				   <p>|
					   
						   <a href="/categories/objective-c">objective-c</a> | 
					   
						   <a href="/categories/other">other</a> | 
					   
						   <a href="/categories/node-js">node.js</a> | 
					   
						   <a href="/categories/ruby-on-rails">ruby on rails</a> | 
					   
						   <a href="/categories/tips">tips</a> | 
					   
						   <a href="/categories/html5">html5</a> | 
					   
						   <a href="/categories/algorithms">algorithms</a> | 
					   
						   <a href="/categories/machine-learning">machine learning</a> | 
					   
						   <a href="/categories/c">c</a> | 
					   
						   <a href="/categories/ruby">ruby</a> | 
					   
				   </p>
				   <h4>Archive</h4>
					   <p>|
					   
	    					<a href="/2013/08/">2013/08</a> | 
	    			   
	    					<a href="/2013/09/">2013/09</a> | 
	    			   
	    					<a href="/2013/11/">2013/11</a> | 
	    			   
	    					<a href="/2013/12/">2013/12</a> | 
	    			   
	    					<a href="/2014/01/">2014/01</a> | 
	    			   
	    					<a href="/2014/03/">2014/03</a> | 
	    			   
	    					<a href="/2014/04/">2014/04</a> | 
	    			   
	    					<a href="/2014/05/">2014/05</a> | 
	    			   
    			   </p>
				   <h4>Work</h4>			   
				   <p>Coming soon... maybe.</p>
			   </div>
		   </div>
	   	</div>

	   	<!-- jQuery -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>	  
	  	<!-- Sdir (slide menu for small screen) -->
<script>
/*! Sidr - v1.2.1 - 2013-11-06
 * https://github.com/artberri/sidr
 * Copyright (c) 2013 Alberto Varela; Licensed MIT */
(function(e){var t=!1,i=!1,n={isUrl:function(e){var t=RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i");return t.test(e)?!0:!1},loadContent:function(e,t){e.html(t)},addPrefix:function(e){var t=e.attr("id"),i=e.attr("class");"string"==typeof t&&""!==t&&e.attr("id",t.replace(/([A-Za-z0-9_.\-]+)/g,"sidr-id-$1")),"string"==typeof i&&""!==i&&"sidr-inner"!==i&&e.attr("class",i.replace(/([A-Za-z0-9_.\-]+)/g,"sidr-class-$1")),e.removeAttr("style")},execute:function(n,s,a){"function"==typeof s?(a=s,s="sidr"):s||(s="sidr");var r,d,l,c=e("#"+s),u=e(c.data("body")),f=e("html"),p=c.outerWidth(!0),g=c.data("speed"),h=c.data("side"),m=c.data("displace"),v=c.data("onOpen"),y=c.data("onClose"),x="sidr"===s?"sidr-open":"sidr-open "+s+"-open";if("open"===n||"toggle"===n&&!c.is(":visible")){if(c.is(":visible")||t)return;if(i!==!1)return o.close(i,function(){o.open(s)}),void 0;t=!0,"left"===h?(r={left:p+"px"},d={left:"0px"}):(r={right:p+"px"},d={right:"0px"}),u.is("body")&&(l=f.scrollTop(),f.css("overflow-x","hidden").scrollTop(l)),m?u.addClass("sidr-animating").css({width:u.width(),position:"absolute"}).animate(r,g,function(){e(this).addClass(x)}):setTimeout(function(){e(this).addClass(x)},g),c.css("display","block").animate(d,g,function(){t=!1,i=s,"function"==typeof a&&a(s),u.removeClass("sidr-animating")}),v()}else{if(!c.is(":visible")||t)return;t=!0,"left"===h?(r={left:0},d={left:"-"+p+"px"}):(r={right:0},d={right:"-"+p+"px"}),u.is("body")&&(l=f.scrollTop(),f.removeAttr("style").scrollTop(l)),u.addClass("sidr-animating").animate(r,g).removeClass(x),c.animate(d,g,function(){c.removeAttr("style").hide(),u.removeAttr("style"),e("html").removeAttr("style"),t=!1,i=!1,"function"==typeof a&&a(s),u.removeClass("sidr-animating")}),y()}}},o={open:function(e,t){n.execute("open",e,t)},close:function(e,t){n.execute("close",e,t)},toggle:function(e,t){n.execute("toggle",e,t)},toogle:function(e,t){n.execute("toggle",e,t)}};e.sidr=function(t){return o[t]?o[t].apply(this,Array.prototype.slice.call(arguments,1)):"function"!=typeof t&&"string"!=typeof t&&t?(e.error("Method "+t+" does not exist on jQuery.sidr"),void 0):o.toggle.apply(this,arguments)},e.fn.sidr=function(t){var i=e.extend({name:"sidr",speed:200,side:"left",source:null,renaming:!0,body:"body",displace:!0,onOpen:function(){},onClose:function(){}},t),s=i.name,a=e("#"+s);if(0===a.length&&(a=e("<div />").attr("id",s).appendTo(e("body"))),a.addClass("sidr").addClass(i.side).data({speed:i.speed,side:i.side,body:i.body,displace:i.displace,onOpen:i.onOpen,onClose:i.onClose}),"function"==typeof i.source){var r=i.source(s);n.loadContent(a,r)}else if("string"==typeof i.source&&n.isUrl(i.source))e.get(i.source,function(e){n.loadContent(a,e)});else if("string"==typeof i.source){var d="",l=i.source.split(",");if(e.each(l,function(t,i){d+='<div class="sidr-inner">'+e(i).html()+"</div>"}),i.renaming){var c=e("<div />").html(d);c.find("*").each(function(t,i){var o=e(i);n.addPrefix(o)}),d=c.html()}n.loadContent(a,d)}else null!==i.source&&e.error("Invalid Sidr Source");return this.each(function(){var t=e(this),i=t.data("sidr");i||(t.data("sidr",s),"ontouchstart"in document.documentElement?(t.bind("touchstart",function(e){e.originalEvent.touches[0],this.touched=e.timeStamp}),t.bind("touchend",function(e){var t=Math.abs(e.timeStamp-this.touched);200>t&&(e.preventDefault(),o.toggle(s))})):t.click(function(e){e.preventDefault(),o.toggle(s)}))})}})(jQuery);
</script>

<script>
	
  	$(document).ready(function() {
		$('#mobile-menu-button').sidr();	  
  	});

  	$('#mobile-menu-button').click(function(e){
  	});


  	$('html').click(function(e){
  		$.sidr('close', 'sidr');
  	});

</script>
	  	<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-28952627-6', 'kazuya.co');
  ga('send', 'pageview');

</script>

	</body>
</html>